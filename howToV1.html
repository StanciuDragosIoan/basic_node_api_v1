<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Domine:wght@400;700&family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Roboto&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/main.css" type="text/css" />
    <title>Basic NodeJS API</title>
  </head>
  <body>
    <h1 class="header">How to Build a Basic NodeJS API</h1>

    <p class="text">
      An API <span class="snippet">Application Programming Interface</span> is a
      critical component for both front-end and back-end developers as all of
      them consume data from these APIs in their apps. In this post we will too
      build a very basic NodeJS API that will allow us to perform CRUD
      operations on our resources. We will later on refactor this little project
      in a more elegant form, but for starters this is good and it will teach
      you how to do a lot of basic things related to backend development.
    </p>
    <p class="text center bold">
      Setup
    </p>
    <p class="text">
      We will start with an empty directory (I named mine project). While inside
      that directory, let's initialize an npm package, so run:
    </p>
    <pre class="code">
      npm init
    </pre>
    <p class="text">
      This command will walk you through the basic steps of configuring your npm
      script:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-1.png" alt="" />
    </div>
    <p class="text">
      Name the project, and next it will ask you for the version, you can type a
      specific one, or leave the field blank and it will put it as
      <span class="snippet">1.0.0</span> for you:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-2.png" alt="" />
    </div>
    <p class="text">
      Next it will ask you for a description and an entry point:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-3.png" alt="" />
    </div>
    <p class="text">
      It will also ask you for a test command and a git repo, but we will not
      include them for now so leave that blank and hit enter:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-4.png" alt="" />
    </div>
    <p class="text">
      Next it will prompt you for some keywords, so let's just enter a bunch:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-5.png" alt="" />
    </div>
    <p class="text">
      It will also ask you for an author so put your name there and:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-6.png" alt="" />
    </div>
    <p class="text">
      Next it wants a licence too, so add whatever or just leave it blank:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-7.png" alt="" />
    </div>
    <p class="text">
      Before saving your <span class="snippet">package.json</span> configuration
      file, it will ask you once more to check everything. Hit enter to confirm:
    </p>
    <div class="devPic">
      <img src="./img/npm-init-8.png" alt="" />
    </div>
    <p class="text">
      Now we are all set and we can start working on the
      <span class="snippet">server.js</span> file. This will be the app entry
      point and the main file of our application. For the version
      <span class="snippet">1.0.0</span> of our application, we will use a very
      simplistic format (do not worry, you will learn a ton from building this
      little project) and put all of our code in one file.
    </p>
    <p class="text">
      Create the <span class="snippet">server.js</span> file and add the below
      code to it:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  }

});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      Next in the <span class="snippet">package.json</span> file, add a
      <span class="snippet">start</span> script under the test one:
    </p>
    <pre class="code">
      {
        "name": "node-js-api",
        "version": "1.0.0",
        "description": "node js api project",
        "main": "server.js",
        "scripts": {
          "test": "echo \"Error: no test specified\" && exit 1",
          "start": "node server.js"
        },
        "keywords": [
          "api",
          "node",
          "beginner"
        ],
        "author": "Dragos",
        "license": "ISC"
      }
      
    </pre>
    <p class="text">
      It is now time to test our server, so in the terminal just run
      <span class="snippet">npm start</span>:
    </p>
    <div class="devPic">
      <img src="./img/npm-start-1.png" alt="" class="" />
    </div>
    <p class="text">
      We can already see in the console that the API is running, and we can
      check it if we go to
      <span class="snippet"
        ><a href="http://localhost:5000" target="_blank"
          >http://localhost:5000</a
        ></span
      >.
    </p>
    <p class="text">
      We will now set up one nice dependency called
      <span class="snippet">nodemon</span> which will enable us to have
      hot-reloading (so the server to re-start automatically whenever we change
      something in our files). This is a nice feature which we currently do not
      have, if for instance you try to change something in the API response, so
      make it say: Welcome to our nodeJS API project, save and the refresh the
      webpage, nothing will change unless you stop the server with
      <span class="snippet">ctr + c</span> and restart it by running
      <span class="snippet">npm start</span>.
    </p>
    <p class="text">
      Stop your server (ctr + c) and run the bellow command to install
      <span class="snippet">nodemon</span> as a dev dependency:
    </p>
    <pre class="code">
      npm i -D nodemon --save 
    </pre>
    <p class="text">
      The <span class="snippet">-D</span> flag tells npm to install
      <span class="snippet">nodemon</span> as a dev dependenciy, while the
      <span class="snippet">--save</span> one updates all the other dependencies
      (if needed).
    </p>
    <p class="text">
      Once the command finishes, you can check your
      <span class="snippet">package.json</span> file to see that
      <span class="snippet">nodemon</span> has been added as a dev dependency:
    </p>
    <div class="devPic">
      <img src="./img/nodemon.png" alt="" />
    </div>
    <p class="text">
      Modify the <span class="snippet">start</span> script in
      <span class="snippet">package.json</span> telling it to start the
      <span class="snippet">server.js</span> file with
      <span class="snippet">nodemon</span> instead of node:
    </p>
    <pre class="code">
      {
        "name": "node-js-api",
        "version": "1.0.0",
        "description": "node js api project",
        "main": "server.js",
        "scripts": {
          "test": "echo \"Error: no test specified\" && exit 1",
          "start": "nodemon server.js"
        },
        "keywords": [
          "api",
          "node",
          "beginner"
        ],
        "author": "Dragos",
        "license": "ISC",
        "devDependencies": {
          "nodemon": "^2.0.4"
        }
      }
    </pre>
    <p class="text">
      Now start the server again with <span class="snippet">npm start</span> and
      change something in the response. The server will automatically restart,
      so you don't have to do it manually each time you change something (so you
      only have to refresh the webpage). This may seem trivial, but during
      development it is extremely useful and practical.
    </p>
    <p class="text center bold">
      Read (from CRUD)
    </p>
    <p class="text">
      We will have all our 'resources' stored in a
      <span class="snippet">db.json</span> file and we will write and read from
      that file. We will also have a couple more files to keep track of what we
      update/delete and everything else.
    </p>
    <p class="text">
      Start by importing the file system module in our server script. We will
      also set the
      <span class="snippet">Content-Type</span> as
      <span class="snippet">text/html</span> so we can return some rudimentary
      views from our API. Finally we will define a second endpoint
      <span class="snippet">/resources</span>:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //write client response
    res.write(`
    &lt;h1&gt;Welcome to the resources page&lt;/h1&gt;
    &lt;p&gt;Please see below all our current resources:&lt;/p&gt;
`);
    //send client response
    res.end();
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      Now if you go to
      <span class="snippet"
        ><a href="http://localhost:5000/resources" target="_blank"
          >http://localhost:5000/resources</a
        ></span
      >
      you will see the view from our second endpoint.
    </p>
    <p class="text">
      It is now time for us to add some hard-coded resources in the
      <span class="snippet">db.json</span> file so we can implement the 'read'
      from CRUD. Create the <span class="snippet">db.json</span> file and add
      the below to it:
    </p>
    <pre class="code">
      {
        "data": [
          "{\"text\":\"test\",\"id\":\"1\",\"date\":\"2020-08-20\"}",
          "{\"text\":\"test\",\"id\":\"4\",\"date\":\"2020-08-20\"}",
          "{\"text\":\"test\",\"id\":\"5\",\"date\":\"2020-08-20\"}"
        ]
      }      
    </pre>
    <p class="text">
      The resources are formatted as a JSON object but encoded as string. Next
      modify the if of the new endpoint as per below:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1>Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //read db.json Asynchronously
    fs.readFile("./db.json", "utf8", (err, data) =&gt; {
      //perform logic while in the callback of readFile
      if (err) {
        throw err;
      }

      //check if db.json is not empty
      if (data !== "") {
        //parse data
        const JSONdata = JSON.parse(data).data;
        //convert to object
        let output = Object.values(JSONdata);
        //map and display in html response
        res.write(`
            Welcome to the resources page:  
            &lt;ul style="list-style:none;"&gt;
            
                ${output.map((item) =&gt; `&lt;li&gt;${item}&lt;/li&gt;`)}
            &lt;/ul&gt;
            
            `);
        //if db.json empty return this view
      } else {
        res.write(
          "Welcome to the resources page, there is nothing to display so far.."
        );
      }

      res.end();
    });
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      You can test the default view for
      <span class="snippet">/resources</span> by deleting all the data in it.
      Next, put the data back and we will start working on the add
      functionality.
    </p>
    <p class="text center bold">
      Create (from CRUD)
    </p>
    <p class="text">
      We will now implement the create functionality for our app. We will need 2
      routes for this, one will handle the form for adding a resource and the
      other one will handle the submit and the processing of the data. Create a
      3rd route, this time <span class="snippet">/resource/add</span> in the
      <span class="snippet">server.js</span> file:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //read db.json Asynchronously
    fs.readFile("./db.json", "utf8", (err, data) =&gt; {
      //perform logic while in the callback of readFile
      if (err) {
        throw err;
      }

      //check if db.json is not empty
      if (data !== "") {
        //parse data
        const JSONdata = JSON.parse(data).data;
        //convert to object
        let output = Object.values(JSONdata);
        //map and display in html response
        res.write(`
            Welcome to the resources page:  
            &lt;ul style="list-style:none;"&gt;
            
                ${output.map((item) =&gt; `&lt;li&gt;${item}&lt;/li&gt;`)}
            &lt;/ul&gt;
            
            `);
        //if db.json empty return this view
      } else {
        res.write(
          "Welcome to the resources page, there is nothing to display so far.."
        );
      }

      res.end();
    });
  } else if (url === `/resource/add`) {
    res.write(`
      &lt;h1&gt;Add a new resource&lt;/h1&gt;
      &lt;form action="/add-resource" method="POST"&gt;
        &lt;label for="text"&gt;Resource Text&lt;/label&gt;
        &lt;input name="text" type="text"/&gt;
        &lt;br&gt; &lt;br&gt; 
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" type="number"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;label for="date"&gt;Submission Date&lt;/label&gt;
        &lt;input name="date" type="date"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Add resource&lt;/button&gt;
      &lt;/form&gt;
    `);
    res.end();
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      The <span class="snippet">/resource/add</span> endpoint will only return
      the form, the <span class="snippet">/add-resource</span> endpoint will do
      the magic behind the scenes and process everything for us. Not that the
      form rendered by <span class="snippet">/resource/add</span> has a method
      attribute (set to POST) and an action attribute (pointing to our
      endpoint).
    </p>
    <p class="text">
      Next create the <span class="snippet">add-resource</span> endpoint. Note
      that for it, we need to check both the method and the url:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;
  //define method
  const method = req.method;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //read db.json Asynchronously
    fs.readFile("./db.json", "utf8", (err, data) =&gt; {
      //perform logic while in the callback of readFile
      if (err) {
        throw err;
      }

      //check if db.json is not empty
      if (data !== "") {
        //parse data
        const JSONdata = JSON.parse(data).data;
        //convert to object
        let output = Object.values(JSONdata);
        //map and display in html response
        res.write(`
            Welcome to the resources page:  
            &lt;ul style="list-style:none;"&gt;
            
                ${output.map((item) =&gt; `&lt;li&gt;${item}&lt;/li&gt;`)}
            &lt;/ul&gt;
            
            `);
        //if db.json empty return this view
      } else {
        res.write(
          "Welcome to the resources page, there is nothing to display so far..",
        );
      }

      res.end();
    });
  } else if (url === `/resource/add`) {
    res.write(`
      &lt;h1&gt;Add a new resource&lt;/h1&gt;
      &lt;form action="/add-resource" method="POST"&gt;
        &lt;label for="text"&gt;Resource Text&lt;/label&gt;
        &lt;input name="text" type="text"/&gt;
        &lt;br&gt; &lt;br&gt; 
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" type="number"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;label for="date"&gt;Submission Date&lt;/label&gt;
        &lt;input name="date" type="date"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Add resource&lt;/button&gt;
      &lt;/form&gt;
    `);
    res.end();
  } else if (url === `/add-resource` && method === "POST") {
    //register event listener for capturing data
    const body = [];
    req.on("data", (chunk) => {
      // grab the data chunks from the buffer stream
      body.push(chunk);
    });

    //use the data once all has been captured
    req.on("end", () => {
      //all data chunks are in body now
      const parsedBody = Buffer.concat(body) //concat chunks
        .toString(); //parse as text
      res.write(`
        here is the data: 
        &lt;br>\&gt;
        ${parsedBody}`);
      res.end();
    });
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      In order to process the data, we use 2 event listeners
      <span class="snippet">on('data')</span> and
      <span class="snippet">on('end')</span>. The
      <span class="snippet">on('data')</span> event listener captures the data
      from the Buffer stream while the
      <span class="snippet">on('end')</span> event listener concatenates all the
      data chunks in the <span class="snippet">body</span> array and parses it
      as string so we can use it further on in our application.
    </p>
    <p class="text">
      Now let's complete the data processing and saving it to the
      <span class="snippet">db.json</span> file. We will add a simple server
      side validation forcing the user to enter resources with a unique id (so
      they cannot enter the same id twice). Next create the
      <span class="snippet">ids.json</span> file and replace the logic for the
      <span class="snippet">/add-resource</span> route as below:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;
  //define method
  const method = req.method;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //read db.json Asynchronously
    fs.readFile("./db.json", "utf8", (err, data) =&gt; {
      //perform logic while in the callback of readFile
      if (err) {
        throw err;
      }

      //check if db.json is not empty
      if (data !== "") {
        //parse data
        const JSONdata = JSON.parse(data).data;
        //convert to object
        let output = Object.values(JSONdata);
        //map and display in html response
        res.write(`
            Welcome to the resources page:  
            &lt;ul style="list-style:none;"&gt;
            
                ${output.map((item) =&gt; `&lt;li&gt;${item}&lt;/li&gt;`)}
            &lt;/ul&gt;
            
            `);
        //if db.json empty return this view
      } else {
        res.write(
          "Welcome to the resources page, there is nothing to display so far..",
        );
      }

      res.end();
    });
  } else if (url === `/resource/add`) {
    res.write(`
      &lt;h1&gt;Add a new resource&lt;/h1&gt;
      &lt;form action="/add-resource" method="POST"&gt;
        &lt;label for="text"&gt;Resource Text&lt;/label&gt;
        &lt;input name="text" type="text"/&gt;
        &lt;br&gt; &lt;br&gt; 
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" type="number"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;label for="date"&gt;Submission Date&lt;/label&gt;
        &lt;input name="date" type="date"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Add resource&lt;/button&gt;
      &lt;/form&gt;
    `);
    res.end();
  } else if (url === `/add-resource` && method === "POST") {
    //register event listener for capturing data
    const body = [];
    req.on("data", (chunk) => {
      // grab the data chunks from the buffer stream
      body.push(chunk);
    });
    //use the data once all has been captured
    req.on("end", () => {
      //all chunks are in body now
      const parsedBody = Buffer.concat(body) //concat chunks
        .toString(); //parse as text

      let rawData = parsedBody.split("&").map((item) => {
        return item.split("=")[1];
      });

      //process data as object
      let processedData = {};
      processedData.text = rawData[0];
      processedData.id = rawData[1];
      processedData.date = rawData[2];
      processedData = JSON.stringify(processedData);

      //validate if ID unique
      fs.readFile("./ids.json", "utf8", (err, data) => {
        if (err) {
          throw err;
        }
        let IDs = data.split("\r\n");
        //check if our id exists in the current ids
        let IdNotUnique = IDs.includes(rawData[1].toString());
        if (IdNotUnique) {
          //force user to enter a unique id
          res.write("Cannot enter duplicate ID...");
          res.end();
        } else {
          //write ID to ids.json
          let id = rawData[1].concat("\r\n");
          //write new resource to db file
          fs.readFile("./db.json", "utf8", (err, data) => {
            if (err) {
              throw err;
            }
            let currentData = data;
            if (currentData === "") {
              //if no previous id just write one
              fs.writeFile("ids.json", id, (err) => {});
              let obj = {};
              obj.data = [];
              obj.data.push(processedData);
              //if no other resource just write the first one
              fs.writeFile("db.json", JSON.stringify(obj), (err) => {});
            } else {
              //if resources already there
              let obj = JSON.parse(currentData);
              //push new resource onto data
              obj.data.push(processedData);
              //append id
              fs.appendFile("ids.json", id, (err) => {});
              //write all resources
              fs.writeFile("db.json", JSON.stringify(obj), (err) => {});
            }

            let refinedData;

            fs.readFile("./db.json", "utf8", (err, data) => {
              if (err) {
                throw err;
              }
              currentData = data;
              refinedData = JSON.parse(currentData).data;
              refinedData = Object.values(refinedData);

              res.write(`
              Welcome to the resources page:
              &lt;ul style="list-style:none;"&lt;
                ${refinedData.map((item) => `&lt;li&lt;${item}&lt;/li&lt;`)}
              &lt;/ul&lt;
              `);

              res.end();
            });
          });
        }
      });
    });
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      Now we can add resources, test that by deleting all the resources from
      <span class="snippet">db.json</span> and the id from
      <span class="snippet">id.json</span> and add a bunch of new resources,
      this time through the API interface. Note that each time you add a
      resource, you are redirected to the
      <span class="snippet">/add-resource</span> endpoint (where you can also
      see the current resources). For adding another resource, go back to
      <span class="snippet">/resource/add</span>. Test also the id validation
      (try adding a new resource with the same id as a previous one). We have
      completed the add functionality of our api.
    </p>
    <p class="text center bold">Update and Delete</p>
    <p class="text">
      We will now implement the update and delete logic. For that we will use 2
      files: <span class="snippet">idToUpdate.json</span> and
      <span class="snippet">idToDelete.json</span>. The 2 files will be used to
      'pass' the ID between routes. The edit/delete functionality will be based
      on a view returned by the endpoint
      <span class="snippet">/resource/:id</span> and whatever id we will type
      after <span class="snippet">/resource</span> will be the one
      edited/deleted. We will also make it so that the same view prompts the
      user to enter a new resource if the
      <span class="snippet">/id</span> introduced does not exist (as we do not
      currently have the respective resource). For this more dynamic in a
      generic <span class="snippet">else { }</span> statement. Create the 2 json
      files mentioned above and dd it as per below:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;
  //define method
  const method = req.method;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //read db.json Asynchronously
    fs.readFile("./db.json", "utf8", (err, data) => {
      //perform logic while in the callback of readFile
      if (err) {
        throw err;
      }

      //check if db.json is not empty
      if (data !== "") {
        //parse data
        const JSONdata = JSON.parse(data).data;
        //convert to object
        let output = Object.values(JSONdata);
        //map and display in html response
        res.write(`
            Welcome to the resources page:  
            &lt;ul style="list-style:none;"&gt;
            
                ${output.map((item) => `&lt;li&gt;${item}&lt;/li&gt;`)}
            &lt;/ul&gt;
            
            `);
        //if db.json empty return this view
      } else {
        res.write(
          "Welcome to the resources page, there is nothing to display so far.."
        );
      }

      res.end();
    });
  } else if (url === `/resource/add`) {
    res.write(`
      &lt;h1&gt;Add a new resource&lt;/h1&gt;
      &lt;form action="/add-resource" method="POST"&gt;
        &lt;label for="text"&gt;Resource Text&lt;/label&gt;
        &lt;input name="text" type="text"/&gt;
        &lt;br&gt; &lt;br&gt; 
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" type="number"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;label for="date"&gt;Submission Date&lt;/label&gt;
        &lt;input name="date" type="date"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Add resource&lt;/button&gt;
      &lt;/form&gt;
    `);
    res.end();
  } else if (url === `/add-resource` && method === "POST") {
    //register event listener for capturing data
    const body = [];
    req.on("data", (chunk) => {
      // grab the data chunks from the buffer stream
      body.push(chunk);
    });
    //use the data once all has been captured
    req.on("end", () => {
      //all chunks are in body now
      const parsedBody = Buffer.concat(body) //concat chunks
        .toString(); //parse as text

      let rawData = parsedBody.split("&").map((item) => {
        return item.split("=")[1];
      });

      //process data as object
      let processedData = {};
      processedData.text = rawData[0];
      processedData.id = rawData[1];
      processedData.date = rawData[2];
      processedData = JSON.stringify(processedData);

      //validate if ID unique
      fs.readFile("./ids.json", "utf8", (err, data) => {
        if (err) {
          throw err;
        }
        let IDs = data.split("\r\n");
        //check if our id exists in the current ids
        let IdNotUnique = IDs.includes(rawData[1].toString());
        if (IdNotUnique) {
          //force user to enter a unique id
          res.write("Cannot enter duplicate ID...");
          res.end();
        } else {
          //write ID to ids.json
          let id = rawData[1].concat("\r\n");
          //write new resource to db file
          fs.readFile("./db.json", "utf8", (err, data) => {
            if (err) {
              throw err;
            }
            let currentData = data;
            if (currentData === "") {
              //if no previous id just write one
              fs.writeFile("ids.json", id, (err) => {});
              let obj = {};
              obj.data = [];
              obj.data.push(processedData);
              //if no other resource just write the first one
              fs.writeFile("db.json", JSON.stringify(obj), (err) => {});
            } else {
              //if resources already there
              let obj = JSON.parse(currentData);
              //push new resource onto data
              obj.data.push(processedData);
              //append id
              fs.appendFile("ids.json", id, (err) => {});
              //write all resources
              fs.writeFile("db.json", JSON.stringify(obj), (err) => {});
            }

            let refinedData;

            fs.readFile("./db.json", "utf8", (err, data) => {
              if (err) {
                throw err;
              }
              currentData = data;
              refinedData = JSON.parse(currentData).data;
              refinedData = Object.values(refinedData);

              res.write(`
              Welcome to the resources page:
              &lt;ul style="list-style:none;"&gt;
                ${refinedData.map((item) => `&lt;li&gt;${item}&lt;/li&gt;`)}
              &lt;/ul&gt;
              `);

              res.end();
            });
          });
        }
      });
    });
  } else {
    //parse the url to grab the id
    let id = url.split("/")[2];
    if (id !== undefined) {
      id.toString();

      //read file async to check for id
      fs.readFile("./ids.json", "utf8", (err, data) =&gt; {
        if (err) {
          throw err;
        }
        let RawIDs = data.split("\r\n");
        //check if we have the id or not
        let isUnique = true;
        RawIDs.map((rawId) => {
          if (rawId === id.toString()) {
            isUnique = false;
          }
        });

        //return view if new id
        if (isUnique === true) {
          res.write(
            `&lt;br&gt;please insert a new component with the 
            id ${id} as it currently does not exist in our DB`
          );
          res.write(`
          &lt;h1&gt;Add a new resource as it currently does not exist&lt;/h1&gt;
          &lt;form action="/add-resource" method="POST"&gt;
            &lt;label for="text"&gt;Resource Text&lt;/label&gt;
            &lt;input name="text" type="text"/&gt;
            &lt;br&gt; &lt;br&gt; 
            &lt;label for="id"&gt;Resource id&lt;/label&gt;
            &lt;input name="id" type="number"/&gt;
            &lt;br&gt; &lt;br&gt;
            &lt;label for="date"&gt;Submission Date&lt;/label&gt;
            &lt;input name="date" type="date"/&gt;
            &lt;br&gt; &lt;br&gt;
            &lt;button&gt;Add resource&lt;/button&gt;
          &lt;/form&gt;
        `);
          //return view if id already exists
        } else {
          res.write(`&lt;br&gt;please edit/delete the item with the id ${id}`);
          fs.writeFile("idToEdit.json", id, (err) =&gt; {});
          fs.writeFile("idToDelete.json", id, (err) =&gt; {});
          res.write(`
            &lt;br&gt;
            &lt;br&gt;
              &lt;button&gt;
                &lt;a 
                  href="http://localhost:5000/edit/resource" 
                  target="_blank"&gt;
                    Edit
                  &lt;/a&gt;
                &lt;/button&gt;
          `);
          res.write(`
          &lt;br&gt;
          &lt;br&gt;
            &lt;button&gt;
              &lt;a 
                href="http://localhost:5000/delete/resource" 
                target="_blank"&gt;
                  Delete
                &lt;a/&gt;
              &lt;/button&gt;
        
        `);
        }

        res.end();
      });
    }
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      Now if you go to
      <span class="snippet">http://localhost:5000/resource/an ID</span> the
      application will either prompt you to edit/delete it or to add it if it
      does not exist. We will now complete our application by creating the last
      2 routes for <span class="snippet">/edit/resource</span> and
      <span class="snippet">/delete/resource</span>:
    </p>
    <pre class="code">
//import http module for our server
const http = require("http");
//import file system module
const fs = require("fs");

//define port for our server to listen to
const PORT = process.env.port || 5000;

//create server
const server = http.createServer((req, res) => {
  //define url
  const url = req.url;
  //define method
  const method = req.method;

  //set content type header
  res.setHeader("Content-Type", "text/html");

  if (url === "/") {
    //write client response
    res.write(`
            &lt;h1&gt;Welcome to our nodeJS API project&lt;/h1&gt;
            &lt;p&gt;This is your first endpoint =)&lt;/p&gt;
        `);
    //send client response
    res.end();
  } else if (url === "/resources") {
    //read db.json Asynchronously
    fs.readFile("./db.json", "utf8", (err, data) =&gt; {
      //perform logic while in the callback of readFile
      if (err) {
        throw err;
      }

      //check if db.json is not empty
      if (data !== "") {
        //parse data
        const JSONdata = JSON.parse(data).data;
        //convert to object
        let output = Object.values(JSONdata);
        //map and display in html response
        res.write(`
            Welcome to the resources page:  
            &lt;ul style="list-style:none;"&gt;
            
                ${output.map((item) =&gt; `&lt;li&gt;${item}&lt;/li&gt;`)}
            &lt;/ul&gt;
            
            `);
        //if db.json empty return this view
      } else {
        res.write(
          "Welcome to the resources page, there is nothing to display so far.."
        );
      }

      res.end();
    });
  } else if (url === `/resource/add`) {
    res.write(`
      &lt;h1&gt;Add a new resource&lt;/h1&gt;
      &lt;form action="/add-resource" method="POST"&gt;
        &lt;label for="text"&gt;Resource Text&lt;/label&gt;
        &lt;input name="text" type="text"/&gt;
        &lt;br&gt; &lt;br&gt; 
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" type="number"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;label for="date"&gt;Submission Date&lt;/label&gt;
        &lt;input name="date" type="date"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Add resource&lt;/button&gt;
      &lt;/form&gt;
    `);
    res.end();
  } else if (url === `/add-resource` && method === "POST") {
    //register event listener for capturing data
    const body = [];
    req.on("data", (chunk) =&gt; {
      // grab the data chunks from the buffer stream
      body.push(chunk);
    });
    //use the data once all has been captured
    req.on("end", () =&gt; {
      //all chunks are in body now
      const parsedBody = Buffer.concat(body) //concat chunks
        .toString(); //parse as text

      let rawData = parsedBody.split("&").map((item) =&gt; {
        return item.split("=")[1];
      });

      //process data as object
      let processedData = {};
      processedData.text = rawData[0];
      processedData.id = rawData[1];
      processedData.date = rawData[2];
      processedData = JSON.stringify(processedData);

      //validate if ID unique
      fs.readFile("./ids.json", "utf8", (err, data) =&gt; {
        if (err) {
          throw err;
        }
        let IDs = data.split("\r\n");
        //check if our id exists in the current ids
        let IdNotUnique = IDs.includes(rawData[1].toString());
        if (IdNotUnique) {
          //force user to enter a unique id
          res.write("Cannot enter duplicate ID...");
          res.end();
        } else {
          //write ID to ids.json
          let id = rawData[1].concat("\r\n");
          //write new resource to db file
          fs.readFile("./db.json", "utf8", (err, data) =&gt; {
            if (err) {
              throw err;
            }
            let currentData = data;
            if (currentData === "") {
              //if no previous id just write one
              fs.writeFile("ids.json", id, (err) =&gt; {});
              let obj = {};
              obj.data = [];
              obj.data.push(processedData);
              //if no other resource just write the first one
              fs.writeFile("db.json", JSON.stringify(obj), (err) =&gt; {});
            } else {
              //if resources already there
              let obj = JSON.parse(currentData);
              //push new resource onto data
              obj.data.push(processedData);
              //append id
              fs.appendFile("ids.json", id, (err) =&gt; {});
              //write all resources
              fs.writeFile("db.json", JSON.stringify(obj), (err) =&gt; {});
            }

            let refinedData;

            fs.readFile("./db.json", "utf8", (err, data) =&gt; {
              if (err) {
                throw err;
              }
              currentData = data;
              refinedData = JSON.parse(currentData).data;
              refinedData = Object.values(refinedData);

              res.write(`
              Welcome to the resources page:
              &lt;ul style="list-style:none;"&gt;
                ${refinedData.map((item) =&gt; `&lt;li&gt;${item}&lt;/li&gt;`)}
              &lt;/ul&gt;
              `);

              res.end();
            });
          });
        }
      });
    });
  } else if (url === "/edit/resource") {
    fs.readFile("./idToEdit.json", "utf8", (err, data) =&gt; {
      if (err) {
        throw err;
      }
      let idToEdit = data;
      console.log(idToEdit);
      res.write(`
      &lt;h1&gt;Edit the resource with the ID: ${idToEdit}&lt;/h1&gt;
      &lt;form action="/edit-resource" method="POST"&gt;
        &lt;label for="text"&gt;Resource Text&lt;/label&gt;
        &lt;input name="text" type="text"/&gt;
        &lt;br&gt; &lt;br&gt; 
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" value=${idToEdit} type="number" disabled="true"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;label for="date"&gt;Submission Date&lt;/label&gt;
        &lt;input name="date" type="date"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Edit resource&lt;/button&gt;
      &lt;/form&gt;
      `);
      res.end();
    });
  } else if (url === "/delete/resource") {
    fs.readFile("./idToDelete.json", "utf8", (err, data) =&gt; {
      if (err) {
        throw err;
      }
      let idToDelete = data;
      console.log(idToDelete);
      res.write(`
      &lt;h1&gt;Delete the resource with the ID: ${idToDelete}&lt;/h1&gt;
      &lt;form action="/delete-resource" method="POST"&gt;
        &lt;label for="id"&gt;Resource id&lt;/label&gt;
        &lt;input name="id" value=${idToDelete} disabled="true" type="number"/&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;br&gt; &lt;br&gt;
        &lt;button&gt;Delete resource&lt;/button&gt;
      &lt;/form&gt;
      `);
      res.end();
    });
  } else {
    //parse the url to grab the id
    let id = url.split("/")[2];
    if (id !== undefined) {
      id.toString();

      //read file async to check for id
      fs.readFile("./ids.json", "utf8", (err, data) =&gt; {
        if (err) {
          throw err;
        }
        let RawIDs = data.split("\r\n");
        //check if we have the id or not
        let isUnique = true;
        RawIDs.map((rawId) =&gt; {
          if (rawId === id.toString()) {
            isUnique = false;
          }
        });

        //return view if new id
        if (isUnique === true) {
          res.write(
            `&lt;br&gt;please insert a new component with 
            the id ${id} as it currently does not exist in our DB`
          );
          res.write(`
          &lt;h1&gt;Add a new resource as it currently does not exist&lt;/h1&gt;
          &lt;form action="/add-resource" method="POST"&gt;
            &lt;label for="text"&gt;Resource Text&lt;/label&gt;
            &lt;input name="text" type="text"/&gt;
            &lt;br&gt; &lt;br&gt; 
            &lt;label for="id"&gt;Resource id&lt;/label&gt;
            &lt;input name="id" type="number"/&gt;
            &lt;br&gt; &lt;br&gt;
            &lt;label for="date"&gt;Submission Date&lt;/label&gt;
            &lt;input name="date" type="date"/&gt;
            &lt;br&gt; &lt;br&gt;
            &lt;button&gt;Add resource&lt;/button&gt;
          &lt;/form&gt;
        `);
          //return view if id already exists
        } else {
          res.write(`&lt;br&gt;please edit/delete the item with the id ${id}`);
          fs.writeFile("idToEdit.json", id, (err) =&gt; {});
          fs.writeFile("idToDelete.json", id, (err) =&gt; {});
          res.write(`
            &lt;br&gt;&lt;br&gt;
              &lt;button&gt;
                &lt;a 
                  href="http://localhost:5000/edit/resource" 
                  target="_blank"&gt;Edit
                &lt;/a&gt;
              &lt;/button&gt;
          `);
          res.write(`
          &lt;br&gt;&lt;br&gt;
            &lt;button&gt;
              &lt;a 
                href="http://localhost:5000/delete/resource" 
                target="_blank"
                &gt;
                  Delete
                &lt;a/&gt;
                &lt;/button&gt;
        
        `);
        }

        res.end();
      });
    }
  }
});

//log some output to see everything's ok
console.log(`Server is running on port: ${PORT} so our API is alive =)`);

//start the server
server.listen(PORT);

    </pre>
    <p class="text">
      We now have full CRUD functionality in our little API. In a later post we
      will refactor and improve this project.
    </p>
  </body>
</html>
